<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM & Media Model Analysis Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <!-- Configure Tailwind to use the Inter font and a modern color palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-cyan': '#0891B2', // Cyan-600
                        'light-bg': '#F8FAFC', // Slate-50
                        'card-bg': '#FFFFFF', // White
                        'sidebar-bg': '#F1F5F9', // Slate-100
                        'text-color': '#1E293B', // Slate-800
                    },
                    boxShadow: {
                        'custom': '0 4px 12px rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar for light theme */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #E2E8F0; /* Slate-200 */
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #94A3B8; /* Slate-400 */
            border-radius: 20px;
            border: 2px solid #F1F5F9;
        }

        /* Tab active state styling */
        .tab-active {
            border-bottom-width: 3px;
            border-color: #0891B2; /* primary-cyan */
            color: #0891B2;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-light-bg font-sans text-text-color antialiased min-h-screen flex flex-col">

    <!-- Header and Navigation Tabs -->
    <header class="bg-card-bg border-b border-gray-200 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl font-extrabold text-primary-cyan tracking-tight mb-4">
                AI Model Analysis Dashboard
            </h1>
            
            <!-- Navigation Tabs -->
            <nav class="border-b border-gray-200">
                <div id="nav-tabs" class="flex space-x-6 overflow-x-auto -mb-[1px]">
                    <!-- Tabs dynamically added here -->
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content Grid -->
    <div class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8 grid lg:grid-cols-4 gap-8">

        <!-- Sidebar / Filter Panel -->
        <aside class="lg:col-span-1 p-6 bg-sidebar-bg rounded-xl shadow-custom h-full sticky top-4">
            <h2 class="text-xl font-bold mb-6 text-primary-cyan border-b border-gray-300 pb-3">
                <span id="current-analysis-title">LLMs (Text)</span> Filters
            </h2>
            
            <div id="loading-message" class="text-center text-sm text-gray-500 py-4 hidden">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-primary-cyan inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Loading data...
            </div>
            <div id="api-error-message" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-sm mb-4 hidden" role="alert">
                <strong class="font-bold">API Warning:</strong> Cannot connect to live data. Using mock data.
            </div>

            <!-- Dynamic Filters Container (LLM or T2I filters will go here) -->
            <div id="dynamic-filters-container" class="space-y-6">
                <!-- LLM filters initially loaded -->
            </div>
            
            <button id="apply-filters-btn" class="mt-8 w-full py-2 px-4 bg-primary-cyan text-white font-semibold rounded-lg shadow-md hover:bg-cyan-600 transition duration-150">
                Apply Filters
            </button>
        </aside>

        <!-- Main Dashboard Area -->
        <div class="lg:col-span-3 space-y-8">
            
            <!-- Visualization Card 1: Main Chart (Dynamically changes) -->
            <div class="p-6 bg-card-bg rounded-xl shadow-custom">
                <h2 id="chart-title" class="text-2xl font-bold mb-4 text-text-color">LLM Intelligence vs. Speed Comparison</h2>
                <div class="h-96">
                    <canvas id="mainChart"></canvas>
                </div>
                <p id="chart-message" class="text-center text-sm text-gray-500 mt-4 hidden">Not enough data to draw the chart.</p>
            </div>
            
            <!-- Visualization Card 2: New LLM Comparison Chart (Hidden initially) -->
            <div id="llm-comparison-card" class="p-6 bg-card-bg rounded-xl shadow-custom hidden">
                <h2 class="text-2xl font-bold mb-4 text-text-color">Intelligence Domain Comparison (Radar Chart)</h2>
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="compare-model-1" class="block text-sm font-medium text-text-color mb-2">Compare Model 1</label>
                        <select id="compare-model-1" class="w-full p-2 rounded-lg bg-sidebar-bg border border-gray-300 text-text-color"></select>
                    </div>
                    <div>
                        <label for="compare-model-2" class="block text-sm font-medium text-text-color mb-2">Compare Model 2</label>
                        <select id="compare-model-2" class="w-full p-2 rounded-lg bg-sidebar-bg border border-gray-300 text-text-color"></select>
                    </div>
                </div>
                <div class="h-96">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <!-- Results Table Card -->
            <div class="p-6 bg-card-bg rounded-xl shadow-custom">
                <h2 id="table-title" class="text-2xl font-bold mb-4 text-text-color">Filtered Model Results</h2>
                
                <div class="overflow-x-auto custom-scroll max-h-[500px]">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-sidebar-bg sticky top-0 z-10">
                            <tr id="results-table-header">
                                <!-- Headers dynamically rendered -->
                            </tr>
                        </thead>
                        <tbody id="results-table-body" class="divide-y divide-gray-200">
                            <tr><td colspan="7" class="text-center py-8 text-gray-500">Select a model type and click Apply Filters.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- New Terminology Card -->
            <div class="p-6 bg-card-bg rounded-xl shadow-custom">
                <h2 class="text-2xl font-bold mb-4 text-text-color border-b border-gray-300 pb-2">Key Terminology & Usage</h2>
                <div class="space-y-4 text-gray-700">
                    <p>This dashboard uses metrics sourced from Artificial Analysis to help you evaluate AI models.</p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            <strong class="text-text-color">Intelligence Index:</strong> A composite score reflecting a model's overall reasoning and knowledge capabilities. Higher is better.
                        </li>
                        <li>
                            <strong class="text-text-color">ELO Rating:</strong> A measure of relative skill or performance, typically used for Media models (Image, Video, Speech). It indicates how a model compares to others in blind human evaluations. An ELO of 1200 is often considered average; higher is better.
                        </li>
                        <li>
                            <strong class="text-text-color">Coding / Math Index:</strong> Sub-scores for Large Language Models indicating proficiency in those specific domains.
                        </li>
                        <li>
                            <strong class="text-text-color">Tokens/Second (Speed):</strong> Measures the output generation speed of LLMs. This is a critical factor for low-latency applications.
                        </li>
                        <li>
                            <strong class="text-text-color">Free/Open Source:</strong> Models that have no associated input pricing (i.e., $0.00/1M input tokens).
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-4 bg-sidebar-bg mt-auto border-t border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            <p>Data based on Artificial Analysis API Mock Data and live free API endpoints. Attribution is required for real-world usage.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- 1. CONFIGURATION AND MOCK DATA ---
        const API_LLM_ENDPOINT = "https://artificialanalysis.ai/api/v2/data/llms/models";
        // NOTE: The API key is blank as per instructions. It will trigger a 401 error, leading to mock data fallback.
        const API_KEY = ""; 
        const MAX_RETRIES = 3;

        const MODEL_TYPES = {
            LLMs: "LLMs (Text)",
            TextToImage: "Text-to-Image",
            ImageEditing: "Image Editing",
            TextToSpeech: "Text-to-Speech",
            TextToVideo: "Text-to-Video",
            ImageToVideo: "Image-to-Video",
        };

        const LLM_COMPARISON_METRICS = {
            'artificial_analysis_coding_index': 'Coding Index',
            'artificial_analysis_math_index': 'Math Index',
            'mmlu_pro': 'MMLU Pro',
            'gpqa': 'GPQA'
        };

        let llmModelList = []; // Will hold fetched or mock LLM data
        
        const FALLBACK_LLM_DATA = [
            { id: "1", name: "GPT-4o", model_creator: { name: "OpenAI" }, evaluations: { artificial_analysis_intelligence_index: 92.5, artificial_analysis_coding_index: 85.0, artificial_analysis_math_index: 90.5, mmlu_pro: 0.95, gpqa: 0.90, hle: 0.88, livecodebench: 0.92, scicode: 0.86, math_500: 0.97, aime: 0.91 }, pricing: { price_1m_input_tokens: 5.0, price_1m_output_tokens: 15.0 }, median_output_tokens_per_second: 120.5 },
            { id: "2", name: "Claude 3 Opus", model_creator: { name: "Anthropic" }, evaluations: { artificial_analysis_intelligence_index: 91.8, artificial_analysis_coding_index: 82.5, artificial_analysis_math_index: 88.0, mmlu_pro: 0.93, gpqa: 0.89, hle: 0.85, livecodebench: 0.90, scicode: 0.84, math_500: 0.95, aime: 0.89 }, pricing: { price_1m_input_tokens: 15.0, price_1m_output_tokens: 75.0 }, median_output_tokens_per_second: 85.0 },
            { id: "3", name: "Gemini 2.5 Flash", model_creator: { name: "Google" }, evaluations: { artificial_analysis_intelligence_index: 84.2, artificial_analysis_coding_index: 75.0, artificial_analysis_math_index: 80.0, mmlu_pro: 0.88, gpqa: 0.79, hle: 0.75, livecodebench: 0.80, scicode: 0.77, math_500: 0.85, aime: 0.81 }, pricing: { price_1m_input_tokens: 0.35, price_1m_output_tokens: 0.70 }, median_output_tokens_per_second: 180.2 },
            { id: "4", name: "Llama 3 8B", model_creator: { name: "Meta" }, evaluations: { artificial_analysis_intelligence_index: 75.1, artificial_analysis_coding_index: 68.0, artificial_analysis_math_index: 72.0, mmlu_pro: 0.81, gpqa: 0.70, hle: 0.65, livecodebench: 0.75, scicode: 0.70, math_500: 0.78, aime: 0.73 }, pricing: { price_1m_input_tokens: 0.0, price_1m_output_tokens: 0.0 }, median_output_tokens_per_second: 150.0 },
            { id: "5", name: "Mistral Large", model_creator: { name: "Mistral AI" }, evaluations: { artificial_analysis_intelligence_index: 88.9, artificial_analysis_coding_index: 80.0, artificial_analysis_math_index: 85.0, mmlu_pro: 0.91, gpqa: 0.85, hle: 0.80, livecodebench: 0.88, scicode: 0.82, math_500: 0.90, aime: 0.87 }, pricing: { price_1m_input_tokens: 8.0, price_1m_output_tokens: 24.0 }, median_output_tokens_per_second: 110.8 },
            { id: "6", name: "GPT-3.5 Turbo", model_creator: { name: "OpenAI" }, evaluations: { artificial_analysis_intelligence_index: 80.5, artificial_analysis_coding_index: 72.0, artificial_analysis_math_index: 75.0, mmlu_pro: 0.85, gpqa: 0.75, hle: 0.70, livecodebench: 0.78, scicode: 0.73, math_500: 0.82, aime: 0.78 }, pricing: { price_1m_input_tokens: 0.5, price_1m_output_tokens: 1.5 }, median_output_tokens_per_second: 165.1 },
        ];

        // MOCK_DATA structure for non-LLM models remains the same
        const MOCK_DATA = {
            TextToImage: [
                { id: "dall-e-3", name: "DALL E 3", model_creator: { name: "OpenAI" }, elo: 1250, rank: 1, categories: [
                    { style_category: "people", subject_matter_category: "portraits", elo: 1280 },
                    { style_category: "scenery", subject_matter_category: "landscapes", elo: 1220 },
                    { style_category: "abstract", subject_matter_category: "geometric", elo: 1250 }
                ]},
                { id: "midjourney", name: "Midjourney", model_creator: { name: "Midjourney Inc." }, elo: 1240, rank: 2, categories: [
                    { style_category: "people", subject_matter_category: "portraits", elo: 1260 },
                    { style_category: "scenery", subject_matter_category: "landscapes", elo: 1230 },
                    { style_category: "abstract", subject_matter_category: "geometric", elo: 1200 }
                ]},
                { id: "imagen", name: "Imagen", model_creator: { name: "Google" }, elo: 1200, rank: 3, categories: [
                    { style_category: "people", subject_matter_category: "portraits", elo: 1190 },
                    { style_category: "scenery", subject_matter_category: "landscapes", elo: 1210 },
                    { style_category: "abstract", subject_matter_category: "geometric", elo: 1220 }
                ]},
            ],
            ImageEditing: [{ name: "ImageEdit-Pro", creator: "Vendor A", elo: 1300, rank: 1 }, { name: "PhotoGen-X", creator: "Vendor B", elo: 1250, rank: 2 }],
            TextToSpeech: [{ name: "VoiceSynth-HD", creator: "Vendor B", elo: 1150, rank: 2 }, { name: "Audionome", creator: "Vendor C", elo: 1280, rank: 1 }],
            TextToVideo: [{ name: "VideoGen-FX", creator: "Vendor D", elo: 1100, rank: 2 }, { name: "ClipForge", creator: "Vendor E", elo: 1350, rank: 1 }],
            ImageToVideo: [{ name: "MotionMaker", creator: "Vendor F", elo: 1180, rank: 2 }, { name: "AnimatiQ", creator: "Vendor G", elo: 1240, rank: 1 }],
        };

        let currentModelType = 'LLMs';
        let mainChart;
        let comparisonChart;

        // --- 2. API FETCHING LOGIC ---

        async function fetchLlmModels(retries = MAX_RETRIES) {
            document.getElementById('api-error-message').classList.add('hidden');
            document.getElementById('loading-message').classList.remove('hidden');

            try {
                const response = await fetch(API_LLM_ENDPOINT, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY 
                    }
                });

                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        throw new Error("API Key Missing/Invalid. Using mock data.");
                    }
                    if (response.status === 429 && retries > 0) {
                        const delay = Math.pow(2, MAX_RETRIES - retries) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchLlmModels(retries - 1);
                    }
                    throw new Error(`API fetch failed with status: ${response.status}`);
                }

                const result = await response.json();
                
                // Process and normalize fetched data to fit dashboard structure
                return result.data.map(model => ({
                    id: model.id,
                    name: model.name,
                    slug: model.slug,
                    model_creator: model.model_creator,
                    evaluations: {
                        // Assuming API provides these fields (and MMLU/GPQA are 0-1, while others are scores)
                        artificial_analysis_intelligence_index: model.evaluations?.artificial_analysis_intelligence_index || 0,
                        artificial_analysis_coding_index: model.evaluations?.artificial_analysis_coding_index || 0, 
                        artificial_analysis_math_index: model.evaluations?.artificial_analysis_math_index || 0,
                        mmlu_pro: model.evaluations?.mmlu_pro || 0,
                        gpqa: model.evaluations?.gpqa || 0,
                    },
                    pricing: model.pricing || { price_1m_input_tokens: 0.0, price_1m_output_tokens: 0.0 },
                    median_output_tokens_per_second: model.median_output_tokens_per_second || 0,
                }));

            } catch (error) {
                // Handle API error gracefully by falling back to mock data
                document.getElementById('api-error-message').classList.remove('hidden');
                return FALLBACK_LLM_DATA;
            } finally {
                document.getElementById('loading-message').classList.add('hidden');
            }
        }

        // --- 3. UTILITY FUNCTIONS ---
        function updateRangeValues() {
            const intelValue = document.getElementById('intelligence-value');
            if (intelValue) intelValue.textContent = document.getElementById('intelligence-range').value;
            
            const speedValue = document.getElementById('speed-value');
            if (speedValue) speedValue.textContent = document.getElementById('speed-range').value;
            
            const priceValue = document.getElementById('price-value');
            if (priceValue) priceValue.textContent = '$' + document.getElementById('price-max').value;
        }

        function createTableHeader(headers) {
            const tr = document.getElementById('results-table-header');
            tr.innerHTML = '';
            headers.forEach(text => {
                const th = document.createElement('th');
                th.scope = 'col';
                th.className = 'px-4 py-3 text-left text-xs font-medium text-primary-cyan uppercase tracking-wider';
                th.textContent = text;
                tr.appendChild(th);
            });
        }

        function clearChart() {
            if (mainChart) {
                mainChart.destroy();
            }
        }
        
        function clearComparisonChart() {
            if (comparisonChart) {
                comparisonChart.destroy();
            }
        }

        // --- 4. RENDERING LOGIC (Model-Specific) ---

        // LLM - Bubble Chart
        function renderLLMChart(data) {
            clearChart();
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (data.length < 2) {
                document.getElementById('chart-message').classList.remove('hidden');
                return;
            }
            document.getElementById('chart-message').classList.add('hidden');

            mainChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: data.map(model => ({
                        label: model.name,
                        data: [{
                            x: model.evaluations.artificial_analysis_intelligence_index, 
                            y: model.median_output_tokens_per_second, 
                            // Ensure model.pricing and price_1m_input_tokens exist for sizing
                            r: Math.max(8, (model.pricing?.price_1m_input_tokens || 0) * 0.5) 
                        }],
                        backgroundColor: 'rgba(8, 140, 180, 0.7)', // Cyan
                        hoverBackgroundColor: 'rgba(6, 78, 97, 0.9)',
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear', position: 'bottom',
                            title: { display: true, text: 'Intelligence Index (Score)', color: '#64748B' },
                            grid: { color: '#E2E8F0' }, ticks: { color: '#334155' }
                        },
                        y: {
                            title: { display: true, text: 'Speed (Tokens/Second)', color: '#64748B' },
                            grid: { color: '#E2E8F0' }, ticks: { color: '#334155' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#334155' } },
                        tooltip: {
                            callbacks: {
                                label: (c) => [ 
                                    c.dataset.label, 
                                    `Intelligence: ${c.parsed.x.toFixed(1)}`, 
                                    `Speed: ${c.parsed.y.toFixed(1)} tokens/s`, 
                                    `Input Price: $${((c.raw.r / 0.5) || 0).toFixed(2)}/1M (Size)` 
                                ]
                            }
                        }
                    }
                }
            });
        }
        
        // LLM - Radar Chart for detailed comparison
        function renderComparisonChart() {
            clearComparisonChart();
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            const model1Id = document.getElementById('compare-model-1').value;
            const model2Id = document.getElementById('compare-model-2').value;

            const model1 = llmModelList.find(m => m.id === model1Id);
            const model2 = llmModelList.find(m => m.id === model2Id);

            if (!model1 || !model2) return;

            const labels = Object.values(LLM_COMPARISON_METRICS);
            
            const getModelDataPoints = (model) => labels.map(label => {
                const key = Object.keys(LLM_COMPARISON_METRICS).find(k => LLM_COMPARISON_METRICS[k] === label);
                // Assume 0-1 range for MMLU/GPQA, 0-100 for AA indices (mock data is scaled, but API might vary)
                let score = model.evaluations[key] || 0;
                // Normalize to 0-100% for radar chart visualization
                return score > 1 ? score : score * 100; 
            });

            comparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: model1.name,
                            data: getModelDataPoints(model1),
                            backgroundColor: 'rgba(8, 145, 178, 0.4)', // Cyan
                            borderColor: 'rgba(8, 145, 178, 1)',
                            pointBackgroundColor: 'rgba(8, 145, 178, 1)',
                            borderWidth: 2,
                        },
                        {
                            label: model2.name,
                            data: getModelDataPoints(model2),
                            backgroundColor: 'rgba(239, 68, 68, 0.4)', // Red
                            borderColor: 'rgba(239, 68, 68, 1)',
                            pointBackgroundColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 2,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: { borderWidth: 3 }
                    },
                    scales: {
                        r: {
                            angleLines: { color: '#E2E8F0' },
                            grid: { color: '#E2E8F0' },
                            pointLabels: { color: '#334155', font: { size: 12 } },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#334155' } },
                        tooltip: { callbacks: { label: (c) => `${c.dataset.label}: ${c.raw.toFixed(1)}%` } }
                    }
                }
            });
        }

        function renderLLMTable(data) {
            createTableHeader(["Model", "Creator", "Intelligence Index", "Coding Index", "Math Index", "Speed (tokens/s)", "Input Price ($/1M)"]);
            const tbody = document.getElementById('results-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">No LLMs match the current filter criteria.</td></tr>';
                return;
            }

            data.forEach(model => {
                const row = tbody.insertRow();
                row.className = 'hover:bg-gray-100 transition duration-150';
                
                row.insertCell(0).textContent = model.name;
                row.insertCell(1).textContent = model.model_creator.name;
                row.insertCell(2).textContent = model.evaluations.artificial_analysis_intelligence_index.toFixed(1);
                row.insertCell(3).textContent = (model.evaluations.artificial_analysis_coding_index * 100).toFixed(1); // Scale for display if 0-1
                row.insertCell(4).textContent = (model.evaluations.artificial_analysis_math_index * 100).toFixed(1); // Scale for display if 0-1
                row.insertCell(5).textContent = model.median_output_tokens_per_second.toFixed(1);
                row.insertCell(6).textContent = `$${(model.pricing.price_1m_input_tokens || 0).toFixed(2)}`;

                row.cells[0].className = 'px-4 py-3 whitespace-nowrap font-medium text-primary-cyan';
                for (let i = 1; i < 7; i++) {
                    row.cells[i].className = 'px-4 py-3 whitespace-nowrap text-sm text-text-color';
                }
            });
        }


        // Media Model Rendering (T2I, Image Editing, etc.)
        
        function renderT2IChart(data) {
            clearChart();
            clearComparisonChart();
            document.getElementById('llm-comparison-card').classList.add('hidden');
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (data.length === 0) {
                document.getElementById('chart-message').classList.remove('hidden');
                return;
            }
            document.getElementById('chart-message').classList.add('hidden');

            const labels = data.map(m => m.name);
            const overallElo = data.map(m => m.elo);

            // Extract category data for overlay (include_categories=true logic)
            const categoryMap = {};
            data.forEach(model => {
                model.categories.forEach(cat => {
                    const key = cat.style_category;
                    if (!categoryMap[key]) {
                        categoryMap[key] = {
                            label: `${key} ELO`,
                            data: [],
                            backgroundColor: getRandomColor(key),
                            stack: 'stack1'
                        };
                    }
                    categoryMap[key].data.push(cat.elo);
                });
            });

            const datasets = [
                ...Object.values(categoryMap),
                {
                    label: 'Overall ELO',
                    data: overallElo,
                    backgroundColor: 'rgba(8, 145, 178, 1)', // Primary Cyan
                    type: 'bar',
                    order: 0,
                    stack: 'stack1'
                }
            ];

            mainChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 1000,
                            title: { display: true, text: 'ELO Rating', color: '#64748B' },
                            grid: { color: '#E2E8F0' }, ticks: { color: '#334155' }
                        },
                        x: {
                            grid: { display: false }, ticks: { color: '#334155' },
                            stacked: false
                        }
                    },
                    plugins: {
                        title: { display: true, text: 'Overall and Category-Specific ELO Ratings', color: '#334155' },
                        legend: { labels: { color: '#334155' } },
                        tooltip: { mode: 'index', intersect: false }
                    }
                }
            });
        }

        function renderT2ITable(data) {
            createTableHeader(["Rank", "Model", "Creator", "Overall ELO", "Category Breakdown"]);
            const tbody = document.getElementById('results-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">No Text-to-Image models found.</td></tr>';
                return;
            }

            data.sort((a, b) => a.rank - b.rank).forEach(model => {
                const row = tbody.insertRow();
                row.className = 'hover:bg-gray-100 transition duration-150';
                
                row.insertCell(0).textContent = model.rank;
                row.insertCell(1).textContent = model.name;
                row.insertCell(2).textContent = model.model_creator.name;
                row.insertCell(3).textContent = model.elo;
                
                const breakdownCell = row.insertCell(4);
                breakdownCell.className = 'px-4 py-3 text-sm text-text-color';
                
                const breakdownHtml = model.categories.map(cat => 
                    `<span class="inline-block bg-gray-200 rounded-full px-3 py-1 text-xs font-semibold text-gray-700 mr-2 mb-1">${cat.style_category}: ${cat.elo}</span>`
                ).join('');
                breakdownCell.innerHTML = breakdownHtml;

                row.cells[1].className = 'px-4 py-3 whitespace-nowrap font-medium text-primary-cyan';
                row.cells[0].className = 'px-4 py-3 whitespace-nowrap text-sm text-text-color';
                row.cells[2].className = 'px-4 py-3 whitespace-nowrap text-sm text-text-color';
                row.cells[3].className = 'px-4 py-3 whitespace-nowrap text-sm font-bold text-text-color';
            });
        }
        
        function renderGenericELOTable(data, title) {
            clearChart();
            clearComparisonChart();
            document.getElementById('llm-comparison-card').classList.add('hidden');
            createTableHeader(["Rank", "Model", "Creator", "ELO Rating"]);
            const tbody = document.getElementById('results-table-body');
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-gray-500">No ${title} models found.</td></tr>`;
                return;
            }

            data.sort((a, b) => a.rank - b.rank).forEach(model => {
                const row = tbody.insertRow();
                row.className = 'hover:bg-gray-100 transition duration-150';
                
                row.insertCell(0).textContent = model.rank;
                row.insertCell(1).textContent = model.name;
                row.insertCell(2).textContent = model.creator;
                row.insertCell(3).textContent = model.elo;

                row.cells[1].className = 'px-4 py-3 whitespace-nowrap font-medium text-primary-cyan';
                for (let i = 0; i < 4; i++) {
                    row.cells[i].className = row.cells[i].className.includes('font-medium') ? row.cells[i].className : 'px-4 py-3 whitespace-nowrap text-sm text-text-color';
                }
            });

            renderGenericELOChart(data, title);
        }

        function renderGenericELOChart(data, title) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (data.length === 0) {
                document.getElementById('chart-message').classList.remove('hidden');
                return;
            }
            document.getElementById('chart-message').classList.add('hidden');
            
            mainChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(m => m.name),
                    datasets: [{
                        label: 'ELO Rating',
                        data: data.map(m => m.elo),
                        backgroundColor: 'rgba(251, 191, 36, 0.7)', // Yellow/Gold color
                        borderColor: 'rgba(251, 191, 36, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: Math.min(...data.map(m => m.elo)) - 50,
                            title: { display: true, text: 'ELO Rating', color: '#64748B' },
                            grid: { color: '#E2E8F0' }, ticks: { color: '#334155' }
                        },
                        x: {
                            grid: { display: false }, ticks: { color: '#334155' }
                        }
                    },
                    plugins: {
                        title: { display: true, text: `Top ${title} Models by ELO Rating`, color: '#334155' },
                        legend: { display: false }
                    }
                }
            });
        }


        // --- 5. FILTERING LOGIC ---
        function getModelData() {
            // Check if LLM list is populated; otherwise return the relevant mock list
            if (currentModelType === 'LLMs') {
                return llmModelList;
            }
            return MOCK_DATA[currentModelType] || [];
        }

        function applyFilters() {
            const data = getModelData();
            
            document.getElementById('current-analysis-title').textContent = MODEL_TYPES[currentModelType];
            document.getElementById('chart-title').textContent = `${MODEL_TYPES[currentModelType]} Analysis`;
            document.getElementById('table-title').textContent = `${MODEL_TYPES[currentModelType]} Model Results`;

            let filteredData = [...data];

            if (currentModelType === 'LLMs') {
                document.getElementById('llm-comparison-card').classList.remove('hidden');
                updateRangeValues();

                const creator = document.getElementById('creator-filter').value;
                const pricingTier = document.getElementById('pricing-tier-filter').value;
                const minIntelligence = parseFloat(document.getElementById('intelligence-range').value);
                const minSpeed = parseFloat(document.getElementById('speed-range').value);
                const maxPrice = parseFloat(document.getElementById('price-max').value);

                filteredData = data.filter(model => {
                    const price = model.pricing?.price_1m_input_tokens || 0;
                    
                    const creatorMatch = (creator === 'all' || model.model_creator.name === creator);
                    const intelligenceMatch = model.evaluations.artificial_analysis_intelligence_index >= minIntelligence;
                    const speedMatch = model.median_output_tokens_per_second >= minSpeed;
                    const priceMatch = price <= maxPrice;

                    let tierMatch = true;
                    if (pricingTier === 'free_open') {
                        // Check if price is zero (or very close to zero, or undefined)
                        tierMatch = price <= 0.0001; 
                    } else if (pricingTier === 'paid') {
                        // Check if price is greater than zero
                        tierMatch = price > 0.0001;
                    }

                    return creatorMatch && intelligenceMatch && speedMatch && priceMatch && tierMatch;
                });
                renderLLMChart(filteredData);
                renderLLMTable(filteredData);
                renderComparisonChart();
            } else if (currentModelType === 'TextToImage') {
                // T2I filtering logic can be expanded here
                renderT2IChart(filteredData);
                renderT2ITable(filteredData);
            } else {
                // Generic ELO models
                renderGenericELOTable(filteredData, MODEL_TYPES[currentModelType]);
            }
        }

        // --- 6. DYNAMIC FILTER SETUP ---
        function loadDynamicFilters() {
            const container = document.getElementById('dynamic-filters-container');
            container.innerHTML = '';
            
            // Reusable Creator Dropdown HTML
            const creatorHtml = `
                <div>
                    <label for="creator-filter" class="block text-sm font-medium text-text-color mb-2">Model Creator</label>
                    <select id="creator-filter" class="w-full p-2 rounded-lg bg-card-bg border border-gray-300 focus:ring-primary-cyan focus:border-primary-cyan text-text-color">
                        <option value="all">All Creators</option>
                    </select>
                </div>
            `;
            
            if (currentModelType === 'LLMs') {
                // LLM Specific Filters
                container.innerHTML = creatorHtml + `
                    <!-- Pricing Tier Filter -->
                    <div>
                        <label for="pricing-tier-filter" class="block text-sm font-medium text-text-color mb-2">Pricing Tier</label>
                        <select id="pricing-tier-filter" class="w-full p-2 rounded-lg bg-card-bg border border-gray-300 focus:ring-primary-cyan focus:border-primary-cyan text-text-color">
                            <option value="all">All Models</option>
                            <option value="paid">Paid Models</option>
                            <option value="free_open">Free / Open Source</option>
                        </select>
                    </div>

                    <!-- Intelligence Index Filter -->
                    <div>
                        <label for="intelligence-range" class="block text-sm font-medium text-text-color mb-2">Intelligence Index (Min: <span id="intelligence-value">0</span>)</label>
                        <input type="range" id="intelligence-range" min="0" max="100" value="0" step="5" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer range-lg">
                    </div>
    
                    <!-- Speed Filter (Tokens/Sec) -->
                    <div>
                        <label for="speed-range" class="block text-sm font-medium text-text-color mb-2">Speed (Min: <span id="speed-value">0</span> tokens/sec)</label>
                        <input type="range" id="speed-range" min="0" max="200" value="0" step="10" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer range-lg">
                    </div>
    
                    <!-- Pricing Filter (Max Input Price) -->
                    <div>
                        <label for="price-max" class="block text-sm font-medium text-text-color mb-2">Max Input Price (<span id="price-value">$20</span>/1M tokens)</label>
                        <input type="range" id="price-max" min="0" max="50" value="20" step="1" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer range-lg">
                    </div>
                `;

                // Reinitialize dynamic event listeners
                document.getElementById('intelligence-range').addEventListener('input', updateRangeValues);
                document.getElementById('speed-range').addEventListener('input', updateRangeValues);
                document.getElementById('price-max').addEventListener('input', updateRangeValues);
                
                
                // Populate creator dropdown for LLMs
                const creators = [...new Set(llmModelList.map(m => m.model_creator.name))].sort();
                const creatorSelect = document.getElementById('creator-filter');
                creators.forEach(creator => {
                    const option = document.createElement('option');
                    option.value = creator;
                    option.textContent = creator;
                    creatorSelect.appendChild(option);
                });

            } else if (currentModelType === 'TextToImage') {
                // T2I Specific Filters
                container.innerHTML = creatorHtml + `
                    <div>
                        <label for="t2i-category-filter" class="block text-sm font-medium text-text-color mb-2">Filter by Category</label>
                        <select id="t2i-category-filter" class="w-full p-2 rounded-lg bg-card-bg border border-gray-300 focus:ring-primary-cyan focus:border-primary-cyan text-text-color">
                            <option value="all">All Categories</option>
                        </select>
                    </div>
                `;
                // Populate creator dropdown for T2I
                const creators = [...new Set(MOCK_DATA.TextToImage.map(m => m.model_creator.name))].sort();
                const creatorSelect = document.getElementById('creator-filter');
                creators.forEach(creator => {
                    const option = document.createElement('option');
                    option.value = creator;
                    option.textContent = creator;
                    creatorSelect.appendChild(option);
                });
                // Populate categories for T2I
                const categories = [...new Set(MOCK_DATA.TextToImage[0].categories.map(c => c.style_category))].sort();
                const categorySelect = document.getElementById('t2i-category-filter');
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                    categorySelect.appendChild(option);
                });
            } else {
                // Simple Creator filter for generic ELO
                const currentData = getModelData();
                const creators = [...new Set(currentData.map(m => m.creator))].sort();
                container.innerHTML = creatorHtml;

                const creatorSelect = document.getElementById('creator-filter');
                creators.forEach(creator => {
                    const option = document.createElement('option');
                    option.value = creator;
                    option.textContent = creator;
                    creatorSelect.appendChild(option);
                });
            }
        }
        
        // Populate the model comparison dropdowns
        function populateComparisonDropdowns() {
            const select1 = document.getElementById('compare-model-1');
            const select2 = document.getElementById('compare-model-2');
            
            select1.innerHTML = '';
            select2.innerHTML = '';
            
            const models = llmModelList;

            models.forEach(model => {
                const option1 = document.createElement('option');
                option1.value = model.id;
                option1.textContent = model.name;
                select1.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = model.id;
                option2.textContent = model.name;
                select2.appendChild(option2);
            });

            // Set default selections
            if (models.length > 0) {
                select1.value = models[0].id;
            }
            if (models.length > 1) {
                select2.value = models[1].id;
            }
        }

        function setupTabHandlers() {
            const tabsContainer = document.getElementById('nav-tabs');
            tabsContainer.innerHTML = '';

            Object.keys(MODEL_TYPES).forEach(key => {
                const button = document.createElement('button');
                button.textContent = MODEL_TYPES[key];
                button.className = `px-4 py-2 text-sm font-medium text-gray-500 hover:text-primary-cyan transition-colors duration-150 border-b-2 border-transparent focus:outline-none`;
                button.setAttribute('data-model-type', key);
                tabsContainer.appendChild(button);

                button.addEventListener('click', () => {
                    // Update active state
                    document.querySelectorAll('#nav-tabs button').forEach(btn => btn.classList.remove('tab-active'));
                    button.classList.add('tab-active');

                    // Update global type and render content
                    currentModelType = key;
                    loadDynamicFilters(); 
                    applyFilters();
                });
            });

            // Set default active tab
            const defaultTab = tabsContainer.querySelector(`[data-model-type="${currentModelType}"]`);
            if (defaultTab) {
                defaultTab.classList.add('tab-active');
            }
        }

        // Random color generator for T2I category chart
        function getRandomColor(seed) {
            const colors = {
                people: 'rgba(239, 68, 68, 0.6)', // Red
                scenery: 'rgba(5, 150, 105, 0.6)', // Green
                abstract: 'rgba(99, 102, 241, 0.6)', // Indigo
                default: 'rgba(129, 140, 248, 0.6)'
            };
            return colors[seed] || colors.default;
        }

        // --- 7. INITIALIZATION ---
        async function initializeDashboard() {
            // 1. Fetch data (this is async)
            llmModelList = await fetchLlmModels();
            
            // 2. Setup UI handlers
            setupTabHandlers();
            document.getElementById('apply-filters-btn').addEventListener('click', applyFilters);
            
            // 3. Initialize LLM comparison dropdowns (must run AFTER llmModelList is populated)
            populateComparisonDropdowns();
            document.getElementById('compare-model-1').addEventListener('change', renderComparisonChart);
            document.getElementById('compare-model-2').addEventListener('change', renderComparisonChart);

            // 4. Load initial content
            loadDynamicFilters();
            applyFilters();
        }

        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>
